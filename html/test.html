<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Upload to Google Drive (GAS backend)</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
    .box { border: 2px dashed #ccc; padding: 20px; border-radius: 8px; }
    button { margin-top: 10px; padding: 8px 14px; }
    #result { margin-top: 15px; padding: 10px; background: #f1f5f9; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>Upload file vào Google Drive</h2>
  <div class="box">
    <input type="file" id="fileInput">
    <br>
    <button onclick="upload()">Upload</button>
    <div id="result"></div>
  </div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbyUWAmBNwl3QUua9JCBk9nsIVi_LuKlW1_llsNSqHgTtbPjlkx9AC0gPP5G4z_9dQ0z/exec';

    async function upload() {
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];
      const result = document.getElementById("result");

      if (!file) {
        result.innerText = "Vui lòng chọn file!";
        return;
      }

      result.innerText = "Đang đọc file...";

      const reader = new FileReader();
      reader.onload = async function(e) {
        const base64Data = e.target.result.split(",")[1]; // bỏ prefix "data:...;base64,"

        result.innerText = "Đang upload...";

        const body = new URLSearchParams();
        body.append("fileData", base64Data);
        body.append("fileName", file.name);
        body.append("mimeType", file.type);
        body.append("action", 'upload');

        try {
          const res = await fetch(GAS_URL, {
            method: "POST",
            body: body
          });
          const data = await res.json();
          if (data.success) {
            result.innerHTML = `✅ Upload thành công: <a href="${data.url}" target="_blank">${data.name}</a>`;
          } else {
            result.innerText = "❌ Lỗi: " + data.error;
          }
        } catch (err) {
          result.innerText = "❌ Upload thất bại: " + err.message;
        }
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
